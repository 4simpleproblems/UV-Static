<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OFP Browser</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" type="image/x-icon" href="logo.png" />
    <link rel="shortcut icon" type="image/jpg" href="logo.png" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet" />
    
    <!-- CUSTOMIZABLE CSS - Easy to modify styles -->
    <style id="custom-styles">
      /* Base Elements */
      :root {
        --bg-color: #1a1a1a;
        --text-color: #fff;
        --navbar-bg: rgba(25, 25, 25, 0.8);
        --navbar-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        --button-bg: rgba(35, 35, 35, 0.8);
        --button-hover-bg: rgba(50, 50, 50, 0.9);
        --search-bg: rgba(20, 20, 20, 0.8);
        --search-focus-bg: rgba(45, 45, 45, 0.9);
        --search-focus-shadow: 0 0 0 3px rgba(100, 100, 100, 0.5);
        --iframe-bg: #000;
        --footer-text-color: #fff;
        --font-family-main: 'Roboto Mono', monospace;
        --font-family-alt: 'Open Sans', sans-serif;
      }

      html, body {
        margin: 0;
        padding: 0;
        border: none;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: var(--font-family-main);
        background-color: var(--bg-color);
        color: var(--text-color);
      }
      
      body {
        display: flex;
        flex-direction: column;
      }
      
      /* Navigation Bar */
      #nav-bar {
        display: flex;
        align-items: center;
        padding: 12px;
        background-color: var(--navbar-bg);
        box-shadow: var(--navbar-shadow);
      }
      
      /* Buttons */
      .nav-button {
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        border-radius: 50%;
        background-color: var(--button-bg);
        cursor: pointer;
        color: var(--text-color);
        transition: background-color 0.2s, color 0.2s;
      }
      
      .nav-button:hover {
        background-color: var(--button-hover-bg);
      }
      
      .fullscreen-button {
        margin-left: 10px;
        margin-right: 0;
      }
      
      /* Search Bar */
      #search-bar {
        flex: 1;
        height: 40px;
        border-radius: 30px;
        border: none;
        background-color: var(--search-bg);
        color: var(--text-color);
        padding: 0 18px;
        font-size: 15px;
      }
      
      #search-bar:focus {
        outline: none;
        background-color: var(--search-focus-bg);
        box-shadow: var(--search-focus-shadow);
      }
      
      /* Content Area */
      #content-area {
        flex: 1;
        width: 100%;
        border: none;
        background-color: var(--iframe-bg);
        transition: all 0.4s cubic-bezier(.4,0,.2,1);
        position: relative;
        z-index: 1;
        box-shadow: 0 0 0 0 #0000;
      }
      
      /* Fullscreen Animation States */
      .animating-to-fullscreen {
        transform: scale(1.05);
        opacity: 0.7;
        box-shadow: 0 0 40px 10px #000a;
      }
      
      .fullscreen-iframe {
        position: fixed !important;
        top: 0; left: 0;
        width: 100vw !important;
        height: 100vh !important;
        z-index: 9999;
        background: var(--iframe-bg);
        transform: scale(1);
        opacity: 1;
        box-shadow: 0 0 40px 10px #000a;
      }
      
      .animating-to-normal {
        transform: scale(0.95);
        opacity: 0.7;
        box-shadow: 0 0 40px 10px #000a;
      }
      
      /* Footer */
      .footer-label {
        position: fixed;
        bottom: 0;
        left: 0;
        margin: 1rem;
        font-family: var(--font-family-main);
        font-size: 0.9rem;
        color: var(--footer-text-color);
        text-decoration: none;
        z-index: 1000;
      }
      
      /* Background Canvas */
      canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <div id="nav-bar">
      <div class="nav-button" id="home-button" title="Home">
        <i class="fas fa-home"></i>
      </div>
      <input type="text" id="search-bar" placeholder="Search DuckDuckGo or type a URL">
      <div class="nav-button fullscreen-button" id="fullscreen-button" title="Toggle Fullscreen">
        <i class="fas fa-expand"></i>
      </div>
    </div>
    <iframe id="content-area" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
    <a href="https://4simpleproblems.github.io/proxy-list.html" class="footer-label">Official 4SP Proxy</a>
    <script src="uv/uv.bundle.js"></script>
    <script src="uv/uv.config.js"></script>
    <script src="register-sw.js"></script>
    <script src="stars.js"></script>
    <script>
      // Initialize UV
      async function initUV() {
        try {
          await registerSW();
          console.log("Service worker registered");
        } catch (err) {
          console.error("Failed to register service worker:", err);
        }
      }
      
      // Navigate to URL
      function navigateTo(url) {
        if (!url) return;
        if (!/^https?:\/\//i.test(url) && !url.startsWith('about:')) {
          if (/^([a-z0-9]([a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,}$/i.test(url) ||
              /^(\d{1,3}\.){3}\d{1,3}$/i.test(url)) {
            url = 'http://' + url;
          } else {
            // Changed from Google to DuckDuckGo
            url = 'https://duckduckgo.com/?q=' + encodeURIComponent(url);
          }
        }
        try {
          const encodedUrl = __uv$config.prefix + __uv$config.encodeUrl(url);
          document.getElementById('content-area').src = encodedUrl;
          document.getElementById('search-bar').value = url;
        } catch (err) {
          console.error("Navigation error:", err);
        }
      }

      // Fullscreen animation logic
      function toggleFullscreen() {
        const iframe = document.getElementById('content-area');
        const navBar = document.getElementById('nav-bar');
        const fullscreenButton = document.getElementById('fullscreen-button');
        const footerLabel = document.querySelector('.footer-label');
        const duration = 400; // ms, must match CSS

        if (iframe.classList.contains('fullscreen-iframe')) {
          // Animate exit fullscreen
          iframe.classList.remove('fullscreen-iframe');
          iframe.classList.add('animating-to-normal');
          setTimeout(() => {
            iframe.classList.remove('animating-to-normal');
            navBar.style.display = 'flex';
            footerLabel.style.display = 'block';
            fullscreenButton.innerHTML = '<i class="fas fa-expand"></i>';
          }, duration);
        } else {
          // Animate enter fullscreen
          iframe.classList.add('animating-to-fullscreen');
          navBar.style.display = 'none';
          footerLabel.style.display = 'none';
          setTimeout(() => {
            iframe.classList.remove('animating-to-fullscreen');
            iframe.classList.add('fullscreen-iframe');
            fullscreenButton.innerHTML = '<i class="fas fa-compress"></i>';
          }, duration);
          // Add escape key handler for exiting fullscreen
          document.addEventListener('keydown', function escKeyHandler(e) {
            if (e.key === 'Escape') {
              toggleFullscreen();
              document.removeEventListener('keydown', escKeyHandler);
            }
          });
        }
      }

      // Theme customization function
      function customizeTheme(options) {
        const root = document.documentElement;
        for (const [key, value] of Object.entries(options)) {
          root.style.setProperty(`--${key}`, value);
        }
      }

      // Example usage:
      // customizeTheme({
      //   'bg-color': '#222222', 
      //   'text-color': '#eeeeee',
      //   'navbar-bg': 'rgba(30, 30, 30, 0.9)',
      //   'button-bg': 'rgba(50, 50, 50, 0.8)'
      // });

      // Event Listeners
      document.addEventListener('DOMContentLoaded', async () => {
        await initUV();
        const urlParams = new URLSearchParams(window.location.search);
        const url = urlParams.get('url');
        if (url) {
          navigateTo(url);
        }
        document.getElementById('search-bar').addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            navigateTo(e.target.value);
          }
        });
        document.getElementById('home-button').addEventListener('click', () => {
          window.location.href = "index.html";
        });
        document.getElementById('fullscreen-button').addEventListener('click', () => {
          toggleFullscreen();
        });
        document.getElementById('content-area').addEventListener('load', () => {
          const iframe = document.getElementById('content-area');
          try {
            if (iframe.contentDocument) {
              document.title = iframe.contentDocument.title + ' - OFP Browser';
            } else {
              const currentUrl = document.getElementById('search-bar').value;
              try {
                const hostname = new URL(currentUrl).hostname;
                document.title = hostname + ' - OFP Browser';
              } catch (e) {
                document.title = 'OFP Browser';
              }
            }
          } catch (e) {
            console.log("Title update error:", e);
          }
        });
      });
    </script>
  </body>
</html>
